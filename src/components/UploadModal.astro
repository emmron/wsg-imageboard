---
import UploadForm from './UploadForm.astro';
---

<div id="upload-overlay" class="upload-overlay" style="display: none;">
  <div class="upload-modal" id="upload-modal">
    <button class="close-btn" id="close-upload-modal" aria-label="Close upload modal">Ã—</button>
    <h2>Upload Video</h2>
    <div class="upload-content">
      <UploadForm />
    </div>
  </div>
</div>

<script>
  import { showUploadModal } from '../lib/stores.ts';

  const overlay = document.getElementById('upload-overlay') as HTMLElement;
  const modal = document.getElementById('upload-modal') as HTMLElement;
  const closeBtn = document.getElementById('close-upload-modal') as HTMLButtonElement;

  function closeModal() {
    showUploadModal.set(false);
  }

  if (overlay && modal && closeBtn) {
    // Close modal when clicking overlay
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) {
        closeModal();
      }
    });

    // Close modal when clicking close button
    closeBtn.addEventListener('click', closeModal);

    // Subscribe to modal state changes
    showUploadModal.subscribe((show) => {
      overlay.style.display = show ? 'flex' : 'none';
      
      if (show) {
        modal.focus();
        // Add animation classes
        overlay.style.opacity = '0';
        modal.style.transform = 'scale(0.9) translateY(20px)';
        
        requestAnimationFrame(() => {
          overlay.style.transition = 'opacity 0.25s ease';
          modal.style.transition = 'transform 0.4s cubic-bezier(0.16, 1, 0.3, 1)';
          overlay.style.opacity = '1';
          modal.style.transform = 'scale(1) translateY(0)';
        });
      }
    });

    // Handle upload completion
    window.addEventListener('upload-complete', () => {
      closeModal();
    });
  }
</script>

<style>
  .upload-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.75);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
  }

  .upload-modal {
    background: white;
    border-radius: 8px;
    padding: 30px;
    max-width: 500px;
    width: 100%;
    position: relative;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    max-height: 90vh;
    overflow-y: auto;
  }

  .close-btn {
    position: absolute;
    top: 15px;
    right: 20px;
    background: none;
    border: none;
    font-size: 24px;
    color: #666666;
    cursor: pointer;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .close-btn:hover {
    background: #f5f5f5;
    color: #333333;
  }

  .upload-modal h2 {
    margin: 0 0 25px 0;
    color: #333333;
    font-size: 24px;
    font-weight: 300;
    text-align: center;
    letter-spacing: -1px;
  }

  .upload-content {
    /* Content styles will be handled by UploadForm component */
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .upload-modal {
      margin: 10px;
      padding: 20px;
      max-width: none;
    }

    .upload-modal h2 {
      font-size: 20px;
      margin-bottom: 20px;
    }
  }

  @media (max-width: 480px) {
    .upload-overlay {
      padding: 10px;
    }

    .upload-modal {
      padding: 15px;
    }

    .upload-modal h2 {
      font-size: 18px;
    }
  }
</style>